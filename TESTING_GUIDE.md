# 视频剪辑助手 - 完整测试指南

## 📊 为什么 `run_smoke_test.ps1` 无法打开软件?

### 当前烟雾测试的限制

`run_smoke_test.ps1` 是**静态代码检查**,只验证:
- ✅ 项目文件结构完整
- ✅ 配置文件语法正确
- ✅ 依赖声明正确
- ✅ 代码基本语法无误

**但不会**:
- ❌ 编译 C++ 代码
- ❌ 链接 Qt 和 FFmpeg 库
- ❌ 生成可执行文件(.exe)
- ❌ 启动软件界面

### 要真正运行软件,必须先编译!

---

## 🎯 三种测试方案对比

| 方案 | 时间 | 优点 | 缺点 | 推荐度 |
|------|------|------|------|--------|
| **1. GitHub Actions** | 10-15分钟 | 云端编译,无需本地环境 | 需要网络,首次可能失败 | ⭐⭐⭐⭐⭐ |
| **2. 快速本地编译** | 2-3小时 | 完全控制,可调试 | 需要安装 Qt,占用磁盘 | ⭐⭐⭐ |
| **3. Docker 编译** | 30分钟 | 环境隔离,可重复 | 需要 Docker Desktop | ⭐⭐⭐⭐ |

---

## ✅ 方案 1: GitHub Actions 云端编译 (推荐)

### 当前状态诊断

您的构建显示 `in_progress` 但已运行 10 小时,这是**异常状态**。

### 可能的原因:
1. ❌ **workflow 配置错误** - vcpkg 安装超时
2. ❌ **依赖版本冲突** - Qt 6.9.1 可能不存在
3. ❌ **网络问题** - GitHub Actions 下载依赖失败

### 立即修复步骤:

```powershell
# 1. 取消异常的构建
cd C:\VideoEditor

# 2. 检查 workflow 配置
Get-Content .github\workflows\build.yml

# 3. 修复后重新推送
git add .
git commit -m "Fix workflow configuration"
git push
```

---

## 🔧 方案 2: 本地快速编译

如果 GitHub Actions 持续失败,可以本地编译:

### 步骤 1: 使用已安装的环境

```powershell
# 检查 vcpkg 是否存在
Test-Path D:\videoeditor-env\vcpkg

# 如果存在,直接编译
cd C:\VideoEditor
.\build.ps1
```

**预计时间**: 
- Qt 已安装: 5-10 分钟
- Qt 未安装: 2-3 小时(首次需要安装 Qt)

### 步骤 2: 编译完成后测试

```powershell
# 运行编译好的程序
.\build\Release\VideoEditor.exe

# 或使用打包脚本
.\package.ps1
```

---

## 🐳 方案 3: Docker 容器编译

最干净的编译环境:

### 创建 Dockerfile

我可以帮您创建一个 Dockerfile,在隔离环境中编译。

### 优点:
- ✅ 环境完全隔离
- ✅ 可重复构建
- ✅ 不污染本地系统

### 缺点:
- ❌ 需要安装 Docker Desktop
- ❌ 首次下载镜像较慢(~2GB)

---

## 🚀 立即行动方案

### 方案 A: 修复 GitHub Actions (最快)

```powershell
# 1. 查看当前 workflow 配置
cd C:\VideoEditor
code .github\workflows\build.yml

# 2. 我会帮您修复配置问题

# 3. 推送修复
git add .
git commit -m "Fix GitHub Actions timeout"
git push
```

### 方案 B: 本地编译(如果网络有问题)

```powershell
# 使用已有环境直接编译
cd C:\VideoEditor
.\build.ps1
```

---

## 🎓 理解烟雾测试的层次

### 第 1 层: 静态检查 (当前的 run_smoke_test.ps1) ✅
- **用途**: 提交代码前快速验证
- **时间**: 5 秒
- **检查**: 文件存在、语法正确

### 第 2 层: 编译测试 (需要添加)
- **用途**: 验证代码可以编译
- **时间**: 5-10 分钟
- **检查**: 代码可以生成 exe

### 第 3 层: 功能测试 (需要添加)
- **用途**: 验证软件功能正常
- **时间**: 1-2 分钟
- **检查**: 软件可以启动、界面正常

### 第 4 层: 集成测试 (高级)
- **用途**: 验证完整工作流
- **时间**: 5-10 分钟
- **检查**: 导入视频、编辑、导出

---

## 💡 下一步建议

### 立即执行:

1. **先修复 GitHub Actions** (我来帮您)
   - 检查 workflow 配置
   - 调整依赖版本
   - 添加超时保护

2. **获取可执行文件**
   - GitHub Actions 成功后下载
   - 或本地编译获得

3. **创建完整测试脚本**
   - 添加编译测试
   - 添加功能测试
   - 自动化测试流程

---

## ❓ 常见问题

### Q: 为什么不能直接运行 .cpp 文件?
**A**: C++ 是编译型语言,必须先编译成 .exe 才能运行。不像 Python 可以直接运行 .py 文件。

### Q: 编译需要多长时间?
**A**: 
- 首次编译(安装 Qt): 2-3 小时
- 后续编译(增量): 1-5 分钟
- GitHub Actions: 10-15 分钟

### Q: 可以跳过编译直接测试吗?
**A**: 不可以。必须先有 .exe 文件才能运行软件。但可以用静态分析工具检查代码质量(不运行软件)。

---

## 🔨 我现在可以帮您做什么?

请告诉我您想选择哪个方案:

**A** - 修复 GitHub Actions,云端编译(推荐)  
**B** - 本地编译,获得 exe 文件  
**C** - 创建完整的测试脚本(包含编译+启动)  
**D** - 先查看 workflow 配置,诊断问题  

请输入 A/B/C/D,我会立即帮您执行!
